<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamerkit Cloud - IRL Command Center</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        background: '#000000',
                        surface: '#1c1c1e', 
                        surfaceHighlight: '#2c2c2e',
                        primary: '#ef4444', // Streamerkit Red
                        primaryHover: '#dc2626',
                        twitch: '#9146FF',
                        youtube: '#FF0000',
                        kick: '#53FC18',
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(239, 68, 68, 0.35)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000000;
            background-image: radial-gradient(circle at 50% 0%, #1a0505 0%, #000000 60%);
            color: #f5f5f7;
            overflow: hidden;
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

        .glass-panel {
            background: rgba(28, 28, 30, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card {
            background: rgba(44, 44, 46, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .glass-card:hover {
            background: rgba(44, 44, 46, 0.6);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .input-apple {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .input-apple:focus {
            border-color: #ef4444;
            outline: none;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
        }
        
        .spinner {
            border: 2px solid rgba(255,255,255,0.1);
            border-left-color: #ef4444;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen flex flex-col antialiased font-sans text-sm">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // =================================================================
        // BACKEND INTEGRATION LAYER (MOCK SOCKET SERVICE)
        // ATEN√á√ÉO CORE TEAM: Substituir esta classe pelo cliente real Socket.io
        // =================================================================
        class SocketService {
            constructor() {
                this.listeners = {};
                this.state = {
                    isLive: false,
                    startTime: null,
                    activeSceneId: null, 
                    streamInfo: {
                        title: "üî¥ IRL EM T√ìQUIO - MOCHILA V2 TESTE!",
                        category: "Just Chatting",
                        notification: "Corre que come√ßou! IRL Insana üöÄ"
                    }
                };
                
                // Simula Autentica√ß√£o Inicial
                setTimeout(() => this.mockAuthentication(), 500);
                
                // Simula Telemetria (Heartbeat)
                setInterval(() => this.emitToClient('server:telemetry', this.generateTelemetry()), 1000);
            }

            mockAuthentication() {
                const mockUserData = {
                    id: "123456",
                    username: "StreamerKitUser",
                    avatarUrl: "https://github.com/shadcn.png", 
                    platform: "twitch",
                    channelName: "streamerkit",
                    serverRegion: "sa-east-1",
                    // IMPORTANTE: Isso deve vir do backend para configurar o parent do iframe corretamente
                    appDomain: window.location.hostname || "localhost" 
                };
                this.emitToClient('auth:session', mockUserData);
                this.emitToClient('stream:info', this.state.streamInfo);
            }

            generateTelemetry() {
                const isLive = this.state.isLive;
                const currentBitrate = isLive ? Math.floor(6000 + Math.random() * 800 - 400) : 0;
                
                return {
                    isLive,
                    uptime: isLive ? this.getDuration() : "00:00:00",
                    serverBitrate: currentBitrate,
                    activeSceneId: this.state.activeSceneId,
                    viewers: {
                        total: isLive ? 15420 : 0,
                        twitch: isLive ? 12300 : 0,
                        youtube: isLive ? 2100 : 0,
                        kick: isLive ? 1020 : 0
                    },
                    // INGESTS ARRAY: O Backend deve popular isso dinamicamente baseado nos processos FFMPEG/SRT ativos
                    ingests: [
                        { 
                            id: 0, 
                            title: "MOCHILA V2 (MAIN)", 
                            type: "srt", 
                            online: true, 
                            bitrate: currentBitrate, 
                            fps: 60,
                            battery: 84, 
                            temp: 42, 
                            bonding: { lte1: true, lte2: true, wifi: false } 
                        },
                        { id: 1, title: "CELULAR (BKP)", type: "srt", online: false, bitrate: 0, fps: 0, isBackup: true },
                        { id: 2, title: "BRB LOOP", type: "video", online: true, bitrate: 0, fps: 30 },
                        { id: 3, title: "MAPAS", type: "video", online: true, fps: 1 }
                    ]
                };
            }

            getDuration() {
                if (!this.state.startTime) return "00:00:00";
                const diff = new Date() - this.state.startTime;
                const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
                const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }

            // A√ß√µes vindas do Cliente (Simuladas)
            emitUpdateStreamInfo(newInfo) {
                // Simula delay de rede da API Twitch
                setTimeout(() => {
                    this.state.streamInfo = { ...this.state.streamInfo, ...newInfo };
                    this.emitToClient('stream:info_updated', { success: true, data: this.state.streamInfo });
                }, 1000);
            }

            emitSceneSwitch(sceneId) {
                this.state.activeSceneId = sceneId;
                this.emitToClient('scene:changed', { activeSceneId: sceneId });
            }

            emitStreamAction(action) {
                this.state.isLive = (action === 'start');
                if (action === 'start') this.state.startTime = new Date();
                else this.state.startTime = null;
            }

            // Event Bus Interno (N√£o mexer, simula socket.io)
            on(event, callback) {
                if (!this.listeners[event]) this.listeners[event] = [];
                this.listeners[event].push(callback);
            }
            off(event, callback) {
                if (!this.listeners[event]) return;
                this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);
            }
            emitToClient(event, data) {
                if (this.listeners[event]) this.listeners[event].forEach(cb => cb(data));
            }
        }

        const socket = new SocketService();

        // --- ICONS & UI HELPERS ---
        const Icons = {
            Signal: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/><path d="M22 20V4"/></svg>,
            Wifi: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>,
            Video: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
            Settings: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Play: <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M5 3l14 9-14 9V3z"/></svg>,
            Stop: <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>,
            Grid: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Zap: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Edit: <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Users: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Clock: <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Check: <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>,
            Battery: <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect width="16" height="10" x="2" y="7" rx="2" ry="2"/><line x1="22" x2="22" y1="11" y2="13"/></svg>,
            Thermometer: <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg>,
            Activity: <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
        };

        const BrandIcons = {
            Twitch: <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h2.998L24 9.714V0H6zM5 3h16v12H12.43L9.002 18.428V15H5V3z"/></svg>,
            Youtube: <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>,
            Kick: <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M3 3h3.5v5.5h3.3L15 3h4l-6.3 7.8L20 21h-4.3l-5.7-8h-3.5v8H3V3z"/></svg>
        };

        // Sparkline Component
        const BitrateGraph = ({ value }) => {
            const [history, setHistory] = useState(new Array(20).fill(0));
            useEffect(() => { setHistory(prev => [...prev.slice(1), value]); }, [value]);
            const max = Math.max(...history, 8000);
            const points = history.map((v, i) => `${i * 5},${50 - (v / max) * 50}`).join(' ');
            return (
                <svg className="w-full h-8 overflow-visible" viewBox="0 0 100 50" preserveAspectRatio="none">
                    <polyline points={points} fill="none" stroke="#ef4444" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="opacity-80"/>
                </svg>
            );
        };

        const HardwareBadge = ({ icon, value, unit, warning }) => (
            <div className={`flex items-center gap-1.5 px-2 py-1 rounded-md border ${warning ? 'bg-red-500/10 border-red-500/30 text-red-400' : 'bg-white/5 border-white/5 text-zinc-400'}`}>
                {icon}
                <div className="flex items-baseline gap-0.5">
                    <span className="text-[10px] font-bold font-mono">{value}</span>
                    <span className="text-[8px] opacity-70">{unit}</span>
                </div>
            </div>
        );

        const IngestPreview = ({ data, active, expanded, onClick }) => {
            return (
                <div onClick={onClick} className={`relative rounded-2xl overflow-hidden cursor-pointer transition-all duration-300 group ${active ? 'ring-2 ring-primary shadow-glow z-10' : 'border border-white/5 bg-surface hover:bg-surfaceHighlight hover:border-white/10'} ${expanded ? 'col-span-2 row-span-2' : 'col-span-1 row-span-1'}`}>
                    <div className="absolute inset-0 flex flex-col items-center justify-center bg-black">
                        {data.online ? (
                            <>
                                <div className="absolute inset-0 bg-gradient-to-br from-zinc-900 to-black opacity-80"></div>
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="text-center z-10 flex flex-col items-center gap-2">
                                        <div className={`p-3 rounded-full bg-white/5 backdrop-blur-sm text-zinc-500 ${!active && 'scale-75'}`}>{data.type === 'srt' ? Icons.Wifi : Icons.Video}</div>
                                        {!active && <span className="text-[10px] text-zinc-600 font-medium tracking-wider">PREVIEW</span>}
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="flex flex-col items-center text-zinc-700 opacity-50">
                                <div className="mb-2">{Icons.Signal}</div>
                                <span className="text-[10px] font-mono uppercase tracking-widest">No Signal</span>
                            </div>
                        )}
                    </div>
                    <div className="absolute top-0 left-0 right-0 p-3 flex justify-between items-start bg-gradient-to-b from-black/60 to-transparent backdrop-blur-[2px]">
                        <div className="flex items-center gap-2">
                            <span className={`px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider shadow-sm ${active ? 'bg-primary text-white' : 'glass-card text-zinc-300'}`}>{data.title}</span>
                            {data.isBackup && <span className="text-[9px] bg-yellow-500/20 text-yellow-500 px-1.5 py-0.5 rounded border border-yellow-500/20 font-bold">BKP</span>}
                        </div>
                        {data.online && (
                            <div className="flex items-center gap-2 glass-card px-2 py-0.5 rounded-full">
                                <div className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                                <span className="text-[10px] font-mono text-white">{data.bitrate} kbps</span>
                            </div>
                        )}
                    </div>
                    {data.type === 'srt' && data.online && (
                        <div className="absolute bottom-3 left-3 right-3 flex justify-between items-end">
                            <div className="flex gap-2">
                                <HardwareBadge icon={Icons.Battery} value={data.battery} unit="%" warning={data.battery < 20} />
                                <HardwareBadge icon={Icons.Thermometer} value={data.temp} unit="¬∞C" warning={data.temp > 60} />
                            </div>
                            <div className="flex gap-1">
                                <div className={`w-1 h-3 rounded-full ${data.bonding?.lte1 ? 'bg-green-500' : 'bg-zinc-700'}`} title="Modem 1"></div>
                                <div className={`w-1 h-3 rounded-full ${data.bonding?.lte2 ? 'bg-green-500' : 'bg-zinc-700'}`} title="Modem 2"></div>
                                <div className={`w-1 h-3 rounded-full ${data.bonding?.wifi ? 'bg-blue-500' : 'bg-zinc-700'}`} title="WiFi"></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const StreamInfoEditor = ({ initialInfo, onSave }) => {
            const [info, setInfo] = useState(initialInfo);
            const [status, setStatus] = useState('idle');
            useEffect(() => { setInfo(initialInfo); }, [initialInfo]);
            const handleChange = (field, value) => { setInfo(prev => ({ ...prev, [field]: value })); if(status === 'success') setStatus('idle'); };
            const handleSave = () => { setStatus('saving'); onSave(info, () => { setStatus('success'); setTimeout(() => setStatus('idle'), 2000); }); };

            return (
                <div className="glass-card rounded-2xl p-4 space-y-4 relative overflow-hidden group">
                    <div className="flex justify-between items-center">
                        <span className="text-xs font-bold text-zinc-400 uppercase tracking-widest flex items-center gap-2">{Icons.Edit} Informa√ß√µes da Live</span>
                        <button onClick={handleSave} disabled={status === 'saving'} className={`text-[10px] px-3 py-1.5 rounded-lg transition-all flex items-center gap-2 font-bold shadow-sm hover:shadow-glow ${status === 'success' ? 'bg-green-500 text-white' : status === 'saving' ? 'bg-zinc-700 text-zinc-300 cursor-wait' : 'bg-primary hover:bg-primaryHover text-white'}`}>
                            {status === 'saving' && <div className="spinner"></div>} {status === 'success' && Icons.Check} {status === 'saving' ? 'ENVIANDO...' : status === 'success' ? 'SALVO' : 'ATUALIZAR'}
                        </button>
                    </div>
                    <div className="space-y-3">
                        <div><label className="text-[10px] font-medium text-zinc-500 block mb-1.5 ml-1">T√çTULO</label><input type="text" className="w-full text-xs p-2.5 input-apple font-medium" value={info.title} onChange={(e) => handleChange('title', e.target.value)} /></div>
                        <div className="grid grid-cols-2 gap-3">
                            <div><label className="text-[10px] font-medium text-zinc-500 block mb-1.5 ml-1">CATEGORIA</label><input type="text" className="w-full text-xs p-2.5 input-apple" value={info.category} onChange={(e) => handleChange('category', e.target.value)} /></div>
                            <div><label className="text-[10px] font-medium text-zinc-500 block mb-1.5 ml-1">NOTIFICA√á√ÉO</label><input type="text" className="w-full text-xs p-2.5 input-apple" value={info.notification} onChange={(e) => handleChange('notification', e.target.value)} /></div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [ingestSources, setIngestSources] = useState([]);
            const [appState, setAppState] = useState({ isLive: false, uptime: "00:00:00", serverBitrate: 0, viewers: { total: 0, twitch: 0, youtube: 0, kick: 0 } });
            const [userProfile, setUserProfile] = useState({ username: "...", avatarUrl: null, platform: "twitch", channelName: "", serverRegion: "--", appDomain: "localhost" });
            const [activeSceneId, setActiveSceneId] = useState(null);
            const [streamInfo, setStreamInfo] = useState({ title: "", category: "", notification: "" });
            const saveCallbackRef = useRef(null);

            useEffect(() => {
                socket.on('server:telemetry', (data) => { setAppState(prev => ({ ...prev, ...data })); setIngestSources(data.ingests); });
                socket.on('auth:session', (user) => setUserProfile(user));
                socket.on('stream:info', (info) => setStreamInfo(info));
                socket.on('scene:changed', (data) => setActiveSceneId(data.activeSceneId));
                socket.on('stream:info_updated', (response) => { if (response.success && saveCallbackRef.current) { saveCallbackRef.current(); saveCallbackRef.current = null; setStreamInfo(response.data); } });
                return () => { };
            }, []);

            const handleIngestClick = (id) => { const newId = activeSceneId === id ? null : id; setActiveSceneId(newId); socket.emitSceneSwitch(newId); };
            const toggleStream = () => socket.emitStreamAction(appState.isLive ? 'stop' : 'start');
            const handleSaveStreamInfo = (newInfo, callback) => { saveCallbackRef.current = callback; socket.emitUpdateStreamInfo(newInfo); };

            return (
                <div className="flex flex-col h-full text-zinc-100">
                    <nav className="h-16 glass-panel flex items-center justify-between px-6 shrink-0 z-50">
                        <div className="flex items-center gap-6">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-xl overflow-hidden bg-gradient-to-br from-red-600 to-red-800 flex items-center justify-center shadow-glow">{userProfile.avatarUrl ? <img src={userProfile.avatarUrl} className="w-full h-full object-cover" /> : Icons.Zap}</div>
                                <div className="flex flex-col"><h1 className="font-bold text-sm text-white tracking-tight flex items-center gap-2">Streamerkit <span className="px-1.5 py-0.5 rounded-md bg-white/10 text-[10px] text-zinc-300 font-normal">Cloud</span></h1><div className="flex items-center gap-1.5 mt-0.5"><div className={`w-1.5 h-1.5 rounded-full ${userProfile.serverRegion !== '--' ? 'bg-green-500' : 'bg-red-500'}`}></div><span className="text-[10px] text-zinc-500 font-mono tracking-wide">{userProfile.serverRegion.toUpperCase()}</span></div></div>
                            </div>
                            <div className="h-8 w-px bg-white/10"></div>
                            <div className="flex items-center gap-6">
                                <div className="flex flex-col items-start min-w-[120px]">
                                    <div className="flex items-center gap-1.5 text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-0.5">{Icons.Activity} Cloud Bitrate</div>
                                    <div className="flex items-end gap-2 w-full"><span className="text-lg font-mono font-bold leading-none text-white">{appState.serverBitrate}</span><span className="text-[10px] text-zinc-500 mb-0.5">kbps</span><div className="flex-1 h-4 ml-2"><BitrateGraph value={appState.serverBitrate} /></div></div>
                                </div>
                                <div className="h-8 w-px bg-white/10"></div>
                                <div className="flex flex-col items-start">
                                    <div className="flex items-center gap-1.5 text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-0.5">{Icons.Clock} Session</div>
                                    <span className={`text-lg font-mono font-bold leading-none ${appState.isLive ? 'text-white' : 'text-zinc-600'}`}>{appState.uptime}</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <button onClick={toggleStream} className={`flex items-center gap-2 pl-4 pr-5 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 shadow-lg hover:scale-105 active:scale-95 ${appState.isLive ? 'bg-surface border border-red-500/50 text-red-500 hover:bg-red-500/10' : 'bg-primary hover:bg-primaryHover text-white border border-transparent shadow-glow'}`}>
                                {appState.isLive ? Icons.Stop : Icons.Play} {appState.isLive ? "ENCERRAR" : "INICIAR TRANSMISS√ÉO"}
                            </button>
                            <div className="w-10 h-10 rounded-full bg-surface border border-white/10 flex items-center justify-center text-zinc-400 cursor-pointer hover:bg-white/5 hover:text-white transition-colors">{Icons.Settings}</div>
                        </div>
                    </nav>
                    <div className="flex-1 flex overflow-hidden p-6 gap-6">
                        <aside className="w-64 flex flex-col gap-6 shrink-0">
                             <div className="glass-card rounded-2xl p-4 flex-1 flex flex-col">
                                <h2 className="text-xs font-bold text-zinc-500 uppercase tracking-widest mb-4 px-1">Ingests Ativos</h2>
                                <div className="flex flex-col gap-2">
                                    {ingestSources.map(ingest => (
                                        <div key={ingest.id} onClick={() => handleIngestClick(ingest.id)} className={`p-3 rounded-xl border cursor-pointer transition-all duration-200 flex items-center justify-between group ${activeSceneId === ingest.id ? 'bg-primary/10 border-primary/50' : 'bg-black/20 border-transparent hover:bg-white/5'}`}>
                                            <div className="flex items-center gap-3">
                                                <div className={`w-2 h-2 rounded-full shadow-sm ${ingest.online ? 'bg-green-500 shadow-green-500/50' : 'bg-zinc-700'}`}></div>
                                                <div className="flex flex-col"><span className={`text-xs font-bold ${activeSceneId === ingest.id ? 'text-white' : 'text-zinc-400 group-hover:text-zinc-200'}`}>{ingest.title}</span><span className="text-[9px] text-zinc-600 font-mono tracking-wide">{ingest.type.toUpperCase()}</span></div>
                                            </div>
                                            {activeSceneId === ingest.id && <div className="w-1.5 h-1.5 bg-primary rounded-full animate-pulse"></div>}
                                        </div>
                                    ))}
                                </div>
                             </div>
                        </aside>
                        <main className="flex-1 flex flex-col min-w-0 bg-black rounded-3xl border border-white/10 relative overflow-hidden shadow-2xl">
                            <div className="absolute -inset-10 bg-gradient-to-r from-red-900/20 via-orange-900/10 to-black opacity-40 blur-3xl pointer-events-none"></div>
                            <div className="absolute top-0 left-0 right-0 h-14 flex items-center justify-between px-6 z-20 pointer-events-none">
                                <div className="flex items-center gap-2 pointer-events-auto"><div className="glass-panel px-3 py-1.5 rounded-lg text-[10px] font-bold text-zinc-400 font-mono uppercase tracking-widest border border-white/5">VIEW: {activeSceneId === null ? "MOSAIC" : "FOCUS"}</div></div>
                                {activeSceneId !== null && <button onClick={() => handleIngestClick(activeSceneId)} className="pointer-events-auto glass-panel hover:bg-white/10 text-white px-4 py-1.5 rounded-lg flex items-center gap-2 text-xs font-medium transition-colors">{Icons.Grid} Voltar ao Mosaico</button>}
                            </div>
                            <div className={`relative w-full h-full p-6 grid gap-6 transition-all duration-500 z-10 ${activeSceneId !== null ? 'grid-cols-1 grid-rows-1' : 'grid-cols-2 grid-rows-2'}`}>
                                {ingestSources.map((ingest) => { const isFocused = activeSceneId === ingest.id; const isHidden = activeSceneId !== null && !isFocused; if (isHidden) return null; return (<IngestPreview key={ingest.id} data={ingest} active={isFocused} expanded={activeSceneId !== null} onClick={() => handleIngestClick(ingest.id)} />); })}
                            </div>
                        </main>
                        <aside className="w-[400px] flex flex-col gap-6 shrink-0 overflow-y-auto pr-1 pb-4">
                            <div className="glass-card rounded-2xl p-5 relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-4 opacity-10 text-white">{Icons.Users}</div>
                                <div className="flex flex-col gap-4 relative z-10">
                                    <div><span className="text-[10px] uppercase font-bold text-zinc-500 tracking-widest">Audi√™ncia Total</span><div className="flex items-baseline gap-2 mt-1"><span className="text-3xl font-bold text-white tracking-tight">{appState.viewers.total.toLocaleString()}</span><span className="text-xs text-green-400 font-medium">+12%</span></div></div>
                                    <div className="grid grid-cols-3 gap-2">
                                         <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5"><div className="text-twitch mb-1">{BrandIcons.Twitch}</div><span className="text-xs font-bold text-white">{appState.viewers.twitch.toLocaleString()}</span></div>
                                         <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5"><div className="text-youtube mb-1">{BrandIcons.Youtube}</div><span className="text-xs font-bold text-white">{appState.viewers.youtube.toLocaleString()}</span></div>
                                         <div className="flex flex-col items-center p-2 bg-white/5 rounded-lg border border-white/5"><div className="text-kick mb-1">{BrandIcons.Kick}</div><span className="text-xs font-bold text-white">{appState.viewers.kick.toLocaleString()}</span></div>
                                    </div>
                                </div>
                            </div>
                            <StreamInfoEditor initialInfo={streamInfo} onSave={handleSaveStreamInfo} />
                            <div className="flex-1 min-h-[350px] glass-card rounded-2xl overflow-hidden flex flex-col relative border border-white/5">
                                <div className="h-12 border-b border-white/5 flex items-center justify-between px-4 bg-white/5"><span className="text-xs font-bold text-zinc-300 uppercase tracking-widest flex items-center gap-2">Chat Unificado</span><div className="flex gap-1"><div className="w-2.5 h-2.5 rounded-full bg-red-500"></div><div className="w-2.5 h-2.5 rounded-full bg-yellow-500"></div><div className="w-2.5 h-2.5 rounded-full bg-green-500"></div></div></div>
                                <div className="flex-1 relative bg-black/40">
                                    {userProfile.channelName ? (
                                        <div className="absolute inset-0 flex flex-col">
                                            <iframe src={`https://www.twitch.tv/embed/${userProfile.channelName}/chat?parent=${userProfile.appDomain}&darkpopout`} height="100%" width="100%" className="w-full h-full border-0"></iframe>
                                            <div className="absolute inset-0 pointer-events-none flex flex-col items-center justify-center bg-black/80 backdrop-blur-sm opacity-0 hover:opacity-100 transition-opacity"><p className="text-zinc-400 text-xs font-medium">Embed Ativo: {userProfile.channelName}</p></div>
                                        </div>
                                    ) : (
                                        <div className="absolute inset-0 flex items-center justify-center text-zinc-600 text-xs"><div className="flex flex-col items-center gap-2"><div className="spinner border-zinc-600 border-l-zinc-400"></div><span>Conectando ao Chat...</span></div></div>
                                    )}
                                </div>
                            </div>
                        </aside>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
